# Learning Go - 目錄

## 前言 ................................................................ xiii

## 第一章 設定你的 Go 環境 .................................................. 1
- 安裝 Go 工具 ......................................................... 1
- Go 工作區 ........................................................... 2
- go 命令 ............................................................. 3
  - go run 與 go build ................................................ 3
  - 取得第三方的 Go 工具 .............................................. 5
  - 格式化你的程式碼 ................................................. 6
- Linting 與 Vetting .................................................. 8
- 選擇你的工具 ........................................................ 9
  - Visual Studio Code ............................................... 9
  - GoLand .......................................................... 11
  - The Go Playground ............................................... 12
- Makefiles .......................................................... 14
- 維持最新版本 ....................................................... 15
- 總結 .............................................................. 16

## 第二章 基本型態與宣告 .................................................. 17
- 內建的型態 ......................................................... 17
- 零值 .............................................................. 17
- 常值 .............................................................. 18
- 布林 .............................................................. 19
- 數字型態 ........................................................... 20
- 容許字中的 uint ................................................... 26
- 明確型態轉換 ....................................................... 26
- var vs. := ........................................................ 27
- 使用 const ......................................................... 31
- 已定型態與未定型態的常數 ............................................ 32
- 未使用的變數 ....................................................... 33
- 為變數和常數命名 ................................................... 34
- 總結 .............................................................. 35

## 第三章 複合型態 ....................................................... 35
- 陣列—很難直接使用 .................................................. 35
- slice ............................................................. 37
  - len ............................................................. 39
  - append .......................................................... 41
  - 容量 ............................................................ 42
  - make ............................................................ 46
  - 宣告 slice ...................................................... 46
  - 切割 slice ...................................................... 48
  - 將陣列轉換成 slice .............................................. 51
  - copy ............................................................ 53
- 字串與 rune 與 byte ................................................ 54
- map ............................................................... 55
  - 讀取和寫入 map .................................................. 57
  - 逗號 ok 寫法 .................................................... 59
  - 刪除 map 內容 ................................................... 59
  - 將 map 當成 set 來使用 ........................................... 61
- struct ............................................................ 62
  - 匿名 struct ..................................................... 63
  - 比較與轉換 struct ............................................... 64
- 總結 .............................................................. 66

## 第四章 區塊、遮蔽與控制結構 ............................................ 66
- 區塊 .............................................................. 66
- 遮蔽變數 ........................................................... 67
- if ................................................................ 67
- 四種 for .......................................................... 69
  - 完整的 for 陳述式 ............................................... 69
  - 只有條件式的 for 陳述式 .......................................... 69
  - 無窮的 for 陳述式 ............................................... 70
- break 與 continue ................................................. 71
- for-range 陳述式 .................................................. 72
- 標記 for 陳述式 ................................................... 77
- 選擇正確的 for 陳述式 ............................................. 78
- switch ............................................................ 80
  - 空 switch ....................................................... 83
  - 在 if 與 switch 之間做選擇 ....................................... 84
- goto—沒錯，正是 goto .............................................. 85
- 總結 .............................................................. 87

## 第五章 函式 .......................................................... 89
- 宣告與呼叫函式 ..................................................... 90
- 傳回具名回傳值 ..................................................... 91
- 數量不定的輸入參數與 slice ......................................... 92
- 多個回傳值 ......................................................... 93
- 多個回傳值就是多個值 ............................................... 93
- 忽略回傳值 ......................................................... 94
- 具名回傳值 ......................................................... 95
- 空回傳：絕對不要使用它！ ........................................... 96
- 函式是值 ........................................................... 98
- 函式型態宣告 ....................................................... 99
- 匿名函式 .......................................................... 100
- closure .......................................................... 101
- 將函式當成參數來傳遞 .............................................. 102
- 從函式回傳函式 .................................................... 106
- defer ............................................................ 108
- Go 是以值呼叫的 ................................................... 110
- 總結 ............................................................. 112

## 第六章 指標 ........................................................ 113
- 指標的快速入門 .................................................... 113
- 指標語法 .......................................................... 115
- 用指標來指示可修改的參數 ........................................... 116
- 指標是最終手段 .................................................... 117
- 指標傳遞性能 ...................................................... 117
- 零值 vs. 沒有值 ................................................... 119
- map 與 slice 之間的區別 ............................................ 120
- 將 slice 當成緩衝區 ................................................ 122
- 降低記憶體回收程式的工作負擔 ....................................... 123
- 總結 ............................................................. 124

## 第七章 型態、方法與介面 .............................................. 125
- Go 的型態 ......................................................... 125
- 方法 ............................................................. 126
  - 指標接收子與值接收子 ............................................ 128
  - 為了程式碼重複的方法 ............................................ 130
  - 方法也是函式 ................................................. 132
  - 函式 vs. 方法 ..................................................... 133
  - 型態宣告不是繼承 .................................................. 134
  - 型態是可執行的說明文件 ............................................ 135
  - iota ............................................................. 136
- 用內嵌來組合型態 .................................................. 137
- 內嵌不是繼承 ...................................................... 139
- 介面快速入門 ...................................................... 140
- 介面是型態安全的鴨子定型 ........................................... 141
- 內嵌介面 .......................................................... 142
- 接收方法。回傳 struct ............................................. 143
- 介面與 nil ........................................................ 143
- 空介面沒有任何意思 ................................................ 144
- 型態斷言與 type switch ............................................. 145
- 介面的實行 type switch ............................................ 147
- 隱藏介面讓相依關係容易進行 ......................................... 148
- Wire ............................................................. 149
- Go 不是非物件導向的語言（這是好事） .................................. 162
- 總結 ............................................................. 162

## 第八章 錯誤 ........................................................ 163
- 如何處理錯誤：基本知識 ............................................. 163
- 用字串來類示簡單的錯誤 ............................................. 165
- 哨兵錯誤 .......................................................... 165
- error 是值 ........................................................ 168
- 包裝錯誤 .......................................................... 170
- Is 與 As .......................................................... 172
- 用 defer 來包裝 error ............................................. 175
- panic 與 recover .................................................. 177
- 從 error 取得堆疊追蹤 .............................................. 179
- 總結 ............................................................. 179

## 第九章 模組、程式包與匯入 ............................................ 181
- 版本庫、模組與程式包 ............................................... 181
- go.mod ............................................................ 182
- 建構程式包 ........................................................ 182
  - 匯入與匯出 ...................................................... 183
  - 建立與使用程式包 ................................................ 183
  - 為程式包命名 ...................................................... 185
  - 如何組織你的模組 .................................................. 186
  - 覆寫程式包的名稱 .................................................. 188
  - 程式包註解與 godoc ................................................ 189
  - internal 程式包 .................................................. 190
  - init 函式：請量避免 ............................................... 191
  - 循環依賴關係 ...................................................... 192
  - 優雅地重命名與新組織你的 API ....................................... 194
- 使用模組 .......................................................... 194
  - 匯入第三方程式 .................................................. 196
  - 使用版本 ........................................................ 199
  - 選擇最小版本 .................................................... 199
  - 更新到相容版本 .................................................. 200
  - 更新至不相容的版本 .............................................. 202
- vendoring ......................................................... 202

## 第十章 Go 的並行 .................................................... 203
- 何時該使用並行 .................................................... 203
- goroutine ......................................................... 203
- channel ........................................................... 205
  - 讀取、寫入與緩衝 ................................................ 205
  - for-range 與 channel ............................................. 206
  - 關閉 channel .................................................... 207
  - channel 的行為 .................................................. 208
- select ............................................................ 210
- 並行實踐模式 ...................................................... 212
  - 不要運行放入 API ................................................ 213
  - goroutine、for 迴圈，更會變的變數 ................................... 213
  - 你一定要清理 goroutine ............................................ 217
  - done channel 模式 ................................................. 217
  - 使用取消函式來終結 goroutine ...................................... 219
  - 何時該使用有緩衝與無緩衝的 channel .................................. 219
  - 方法、select 與頻的 case ........................................... 220
  - 如何處理字串式溝通 ................................................ 221
  - 使用 WaitGroup .................................................... 221
  - 只執行程式一次 .................................................... 222
  - 將目前的工具數一台記起來 ........................................... 223
- 何時該用 mutex 來取代 channel ...................................... 223
- 原子運算一你應該要它們 ............................................ 224
- 進一步學習並行的地方 .............................................. 224
- 總結 ............................................................. 225

## 第十一章 標準程式庫 ................................................. 237
- io 與朋友 ......................................................... 237
- time .............................................................. 242
  - 單調時間 ........................................................ 242
  - 計時器與通時 .................................................... 244
- encoding/json ..................................................... 245
  - 使用 struct tag 來加入中繼資料 ................................... 245
  - unmarshal 與 marshal ............................................ 246
  - JSON、Reader 與 Writer .......................................... 247
  - 編碼與解碼 JSON 串流 ............................................. 249
  - 自訂 JSON 解析 .................................................. 250
- net/http .......................................................... 251
  - 用戶端 .......................................................... 252
  - 伺服器 .......................................................... 253
- 總結 ............................................................. 258

## 第十二章 context ................................................... 259
- 什麼是 context？ .................................................. 259
- 取消 ............................................................. 262
- 計時器 ........................................................... 266
- 在你自己的程式中處理 context 取消 ................................... 268
- 值 ............................................................... 269
- 總結 ............................................................. 275

## 第十三章 編寫測試 .................................................. 277
- 測試的基本知識 .................................................... 277
  - 回報測試失敗 ...................................................... 279
  - 設定與拆解 ........................................................ 279
  - 儲存測試資料檔案 .................................................. 281
  - 快取測試結果 ...................................................... 281
  - 測試你的公用 API .................................................. 282
  - 使用 go-cmp 來比較測試結果 ......................................... 284
- 表格測試 .......................................................... 287
- 檢查測試時間覆蓋率 ................................................ 289
- 效能評定 .......................................................... 290
- Go 的 stub ......................................................... 295
- httptest .......................................................... 299
- 整合測試與建構標籤 ................................................ 300
- 使用 Race Checker 來尋找並行問題 ................................... 300
- 使用 ............................................................... 300

## 第十四章 惡龍寶區：Reflect、Unsafe 與 Cgo ........................... 305
- reflection 可讓我們在執行期間用型態 ................................. 305
  - Type、Kind 與 Value ............................................... 306
  - 使用 reflection 來檢查介面的值是不是 nil ........................... 312
  - 使用 reflection 來編寫資料 marshaler ............................... 313
  - 使用 reflection 來建構函式，將重複性的工作自動化 ................... 315
  - 雖然你可以用 reflection 來建構 struct，但不要這樣 ................. 319
  - reflection 無法製作方法 ........................................... 320
  - 值得使用 reflection 嗎？  才使用它 .................................. 320
- unsafe 是不安全的 ................................................. 321
  - 使用 unsafe 來轉換外部的二進制資料 .................................. 322
  - unsafe 字串與 slice .............................................. 325
  - unsafe 工具 ...................................................... 327
- cgo 是用來整合的，不是用來提升性能的 ................................ 327
- 總結 ............................................................. 330

## 第十五章 預見未來：Go 的泛型 ........................................ 331
- 泛型可減少重複的程式，並增加型態安全性 ............................. 331
- 簡介 Go 的泛型 ................................................... 331
- 使用型態串列來指定運作子 .......................................... 334
- 泛型函式抽象演算法 ................................................ 335
- 用型態串列限制常數與實作 ........................................... 339
- 選擇 ............................................................. 339
- 這地的 Go 與沒有 .................................................. 341
- 將來會解鎖的功能 .................................................. 341
- 總結 ............................................................. 342

## 索引 .............................................................. 349